---
title: "cod_chart"
author: "Project Team 2"
date: "2024-06-14"
output: html_document
---

#Load Packages

```{r}
library(tidyverse)
library(dplyr)
library(here)
```

#Load Data

```{r}
data_file_path <- here('data', 'aggregate_data.csv')
data <- read_csv(data_file_path)
```

#Counts COD occurrences by system

```{r}
cod_comp = subset(agg_data, select = c(c_system_abbr, c_ind_cod_type))

cod_comp <- cod_comp |>
  group_by(c_system_abbr, c_ind_cod_type) |>
  mutate(n = n()) |>
  summarise(across(everything(), last))

```

#Calculates percentages

```{r}
cod_comp <- cod_comp |>
  group_by(c_system_abbr) |>
  mutate(percent = (n / sum(n)) * 100) 

max_cod <- cod_comp |> 
  group_by(c_system_abbr) |>
  slice(which.max(n)) |>
  select(c_system_abbr, c_ind_cod_type, n)|>
  rename(max_cod_type = c_ind_cod_type, 
         max_n = n) |>
  right_join(cod_comp)

write.csv(max_cod, "cod_percentages.csv")
```

