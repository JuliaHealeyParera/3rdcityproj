---
title: "data"
author: "Project Team 2"
date: "2024-05-21"
output: html_document
---

#Setup

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(dplyr)
```

## Loading Data

```{r}
data <- read_csv("aggregate_data.csv")
head(data)
```

```{r}
agg_data |> 
  group_by(c_ind_cod_type) |>
  count()

agg_data_cod_covid <- agg_data |> 
  filter(c_ind_cod_type == "COVID-19")

agg_data_cod_covid |> 
  group_by(ind_deathloc) |>
  count()

agg_data |> 
  group_by(c_system_abbr) |> 
  count()
  
```

```{r}

private_manual_incomplete <- prisons_manual_incomplete|> 
  mutate(facility = toupper(facility))

public_manual_incomplete <- public_manual_incomplete |> 
  mutate(facility = toupper(facility))

```

```{r}

priv_not_included <- anti_join(private_manual_incomplete, prisons_hsf, by="hsf_facility_name")
pub_not_included <- anti_join(public_manual_incomplete, prisons_hsf, by="hsf_facility_name")
```

```{r}

#finding missing values in HILFD FacilityID range
setdiff(10000001:	
10007020
, prisons_hsf$V2)
```

#Data Visualization on System-Level Data

```{r}
library(tidyverse)

data <- read_csv("aggregate_data.csv")

ind_cod_dataset <- data %>% 
  select(system, ind_first, ind_last, ind_age, ind_gender, ind_race, ind_deathloc, ind_dod, ind_cod, c_ind_cod_type) %>% 
  count(c_ind_cod_type) 
ind_cod_dataset

ind_cod_dataset %>% 
  ggplot(aes(x = c_ind_cod_type, y = n)) + 
    geom_bar(stat = "identity") +
    geom_text(aes(label = n), vjust = -0.3) +
    labs(title = "Count of Incarcerated Cause of Death Type", x = "Cause of Death Type", y = "Count") + 
    theme_minimal() + 
    theme(
      axis.text.x = element_text(angle = 45, hjust = 1)
    ) + 
    scale_y_continuous(limits = c(0, 3000), breaks = c(500, 1000, 1500, 2000, 2500, 3000))

```

#Missing data percentage 
```{r}

missing_data <- data %>% 
  summarize(across(everything(), ~mean(is.na(.)) * 100)) %>% 
  pivot_longer(cols = everything(), names_to = "variable", values_to = "data_percentage") %>% 
  mutate(data_percentage = round(data_percentage, 2))
missing_data

```

#Missing data percentage by system
```{r}

data %>% 
  group_by(system) %>% 
  summarize(across(everything(), ~mean(is.na(.)) * 100)) %>% 
  pivot_longer(cols = -system, names_to = "variable", values_to = "data_percentage") %>% 
  pivot_wider(names_from = system, values_from = data_percentage)

```
